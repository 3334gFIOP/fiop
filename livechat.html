<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <link rel="icon" href="images/icon.png" type="image/png"/>
    <link rel="stylesheet" href="stylesheet.css">
    <style>
        body.chat-page {
            font-family: Arial, sans-serif;
            background: #000000;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        h1 { margin-left: 10px; }
        p { color: #fff; margin-left: 10px; }

        #chat-wrapper {
            display: flex;
            gap: 20px;
            margin-left: 10px;
        }

        #chat-container {
            width: 400px;
            height: 500px;
            border: 1px solid #555;
            display: flex;
            flex-direction: column;
        }

        #messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            border-bottom: 1px solid #38344a;
        }

        #message-input, #name-input {
            padding: 10px;
            border: none;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 5px;
        }

        #send-btn, #set-name-btn {
            padding: 0px;
            border: none;
            background: #23002d;
            color: white;
            cursor: pointer;
            margin-bottom: 0px;
        }
        #send-btn:hover, #set-name-btn:hover {
            background: #46005a;
        }

        .message {
            margin-bottom: 10px;
        }
        .member {
            font-weight: bold;
            margin-right: 5px;
        }

        #user-list {
            width: 180px;
            height: 480px;
            border: 1px solid #555;
            padding: 10px;
            overflow-y: auto;
        }

        #user-list h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .user-item {
            font-weight: bold;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="chat-page">

    <h1 class="outlined-text">Chat</h1>
    <p>Live Online Chat Thingy:</p>

    <!-- Name + Color input -->
    <div style="margin-left:10px; margin-bottom: 10px;">
        <input style="width: 200px;" type="text" id="name-input" placeholder="Enter your name">
        <input type="color" id="color-input" value="#ff0000" style="margin-left: 5px; width: 30px; height: 30px; padding:0; border:none;">
        <button id="set-name-btn">Set Name</button>
    </div>

    <div id="chat-wrapper">

        <div id="chat-container">
            <div id="messages"></div>
            <input type="text" id="message-input" placeholder="Type a message..." disabled>
            <button id="send-btn" disabled>Send</button>
        </div>

        <div id="user-list">
            <h3>Online Users</h3>
        </div>

    </div>

    <br><br>
    <a href="https://fiop.dev" class="glow-btn" style="margin-left:10px;">Back to home</a>

    <script src="https://cdn.scaledrone.com/scaledrone.min.js"></script>
    <script>
        const CLIENT_ID = '6J1HwHleZ1C79oUB';

        let username = "";
        let userColor = "";
        let drone;
        let members = [];

        const badWords = [
            "arsehole","asshat","asshole","bastard","big black cock","bitch","bloody","blowjob","bollocks",
            "bugger","bullshit","chicken shit","ching chong","clusterfuck","cock","cocksucker","coonass",
            "cornhole","coxâ€“zucker machine","cracker","crap","cunt","dick","dumbass","enshittification",
            "faggot","feck","fuck","fuck her right in the pussy","fuck joe biden","fuck, marry, kill",
            "fuckery","grab 'em by the pussy","healslut","if you see kay","jesus fucking christ","kike",
            "motherfucker","nigga","nigger","pajeet","paki","poof","poofter","prick","pussy","ratfucking",
            "retard","russian warship, go fuck yourself","serving cunt","shit","shit happens","shithouse",
            "shitposting","shitter","shut the fuck up","shut the hell up","slut","son of a bitch","spic",
            "taking the piss","twat","unclefucker","wanker","whore"
        ];

        function cleanText(text) {
            let clean = text.toLowerCase();
            badWords.forEach(word => clean = clean.replace(new RegExp(word, "gi"), "****"));
            return clean;
        }

        document.getElementById("set-name-btn").addEventListener("click", () => {
            const nameInput = document.getElementById("name-input").value.trim();
            const colorInput = document.getElementById("color-input").value;

            if (!nameInput) return;

            // Check if the name is already taken
            const taken = members.some(m => m.clientData.name.toLowerCase() === nameInput.toLowerCase());
            if (taken) {
                alert("That name is already taken. Stop trying to impersonate someone and take the L");
                return;
            }

            username = cleanText(nameInput);
            userColor = colorInput;


            drone = new ScaleDrone(CLIENT_ID, {
                data: { name: username, color: userColor }
            });

            setupChat();

            document.getElementById("message-input").disabled = false;
            document.getElementById("send-btn").disabled = false;
            document.getElementById("name-input").disabled = true;
            document.getElementById("color-input").disabled = true;
            document.getElementById("set-name-btn").disabled = true;
        });

        function setupChat() {
            drone.on("open", error => {
                if (error) return console.error(error);

                const room = drone.subscribe("observable-room");

                room.on("members", m => {
                    members = m;
                    updateUserList();
                });

                room.on("member_join", member => {
                    members.push(member);
                    updateUserList();
                });

                room.on("member_leave", ({ id }) => {
                    const index = members.findIndex(m => m.id === id);
                    if (index !== -1) members.splice(index, 1);
                    updateUserList();
                });

                room.on("data", (text, member) => {
                    if (member) addMessageToListDOM(cleanText(text), member);
                });
            });
        }

        function sendMessage() {
            const input = document.getElementById("message-input");
            const value = input.value.trim();
            if (!value) return;

            input.value = "";
            drone.publish({ room: "observable-room", message: value });
        }

        function createMemberElement(member) {
            const el = document.createElement("span");
            el.textContent = member.clientData.name + ": ";
            el.style.color = member.clientData.color;
            el.className = "member";
            return el;
        }

        function addMessageToListDOM(text, member) {
            const messagesEl = document.getElementById("messages");
            const messageEl = document.createElement("div");

            messageEl.className = "message";
            messageEl.appendChild(createMemberElement(member));
            messageEl.appendChild(document.createTextNode(text));

            messagesEl.appendChild(messageEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function updateUserList() {
            const list = document.getElementById("user-list");
            list.innerHTML = "<h3>Online Users</h3>";

            members.forEach(member => {
                const el = document.createElement("div");
                el.className = "user-item";
                el.textContent = member.clientData.name;
                el.style.color = member.clientData.color;

                // Highlight yourself
                if (member.clientData.name === username) {
                    el.classList.add("outlined-text");
                }

                list.appendChild(el);
            });
        }

        document.getElementById("send-btn").addEventListener("click", sendMessage);
        document.getElementById("message-input").addEventListener("keydown", e => {
            if (e.key === "Enter") sendMessage();
        });
    </script>
</body>
</html>
